#!/bin/bash

# Generate lockscreen wallpaper
if ! [ -f ~/.lockscreen.png ]
then
    convert ~/.wallpaper \
        -resize 160x100 \
        -gaussian-blur 30 \
        -colorspace gray \
        -gamma 0.5 \
        -resize "$(xrandr | grep \* | awk '{print $1}')!" ~/.lockscreen.png
fi


if [[ $1 == '-f' ]] || [ ! -f ~/.nolock ]
then
    # check if notifications were paused
    NOTIFICATIONS_PAUSED=$(dunstctl is-paused)

    # TODO handle mic volume the same way as notifications

    # deactivate notifications
    echo pausing notifications
    dunstctl set-paused true

    # set mic volumes to 0
    pacmd set-source-volume 0 0
    pacmd set-source-volume 1 0

    # lock screen
    echo locking screen
    i3lock -n -i ~/.lockscreen.png

    # reactivate notifications if needed
    if echo $NOTIFICATIONS_PAUSED | grep -q "false"
    then
        echo unpausing notifications
        dunstctl set-paused false
    fi

    # set mic volumes to 17%
    pacmd set-source-volume 0 10000
    pacmd set-source-volume 1 10000

fi
