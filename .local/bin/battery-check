#!/bin/bash

kill $(cat ~/.cache/battery-check.pid)

echo $$ > ~/.cache/battery-check.pid

while true ; do
    if acpi -b | grep -q Discharging ; then

        REMAINING=`acpi -b | grep Discharging | cut -f 5 -d " "`

        while [[ $REMAINING < 00:20:00 ]] && acpi -b | grep -q Discharging; do

            acpi -b | systemd-cat -t check-battery
            notify-send -t 5100 -i battery-empty Battery "Less than 20 minutes left" -u critical

            # renew message every 5 seconds
            sleep 5
        done
    fi

    # check every 20 seconds for low battery
    sleep 25
done
