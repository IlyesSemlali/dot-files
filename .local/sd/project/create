#!/usr/bin/env bash

# creates a new project
#
# This will create project folders in the $PROJECTS_ARCHIVE and link it in the $PROJECTS_PATH
# To remove it use the sd project unlink

source "${HOME}/.local/lib/log"

CURRENT_ORG="$(cat ${HOME}/.cache/project/organization)"
projects_archive=${PROJECTS_ARCHIVE:-${HOME}/work/${CURRENT_ORG}/subjects}
projects_path=${PROJECTS_PATH:-${HOME}/projects/${CURRENT_ORG}}
projects_templates_path=${PROJECTS_TEMPLATES_PATH:-${HOME}/work/${CURRENT_ORG}/.templates/}

# TODO: use organization based templates (for trainings for instance)
# TODO: use fzf to select a template
project_template="${HOME}/.local/share/project_template"

# TODO: check if project hasn't already been created yet
mkdir -p "${projects_archive}/${1}/.project.d" "${projects_path}"

if [ -f "${project_template}" ]; then
  cp "${project_template}" "${projects_archive}/${1}/.project.d/zshrc"
fi

if [ -z "${1}" ]; then
  log_error "project" "no project name was specified"
  exit 1
fi

if ln -sf -t "${projects_path}" "${projects_archive}/${1}"; then
  log_info "project" "successfully created project ${1}"
else
  log_error "project" "couldn't create project ${1}"
  exit 1
fi
